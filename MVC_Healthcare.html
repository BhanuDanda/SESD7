<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Healthcare Appointment Booking — MVC Demo</title>
  <style>
    /* Simple, clean styling for demo */
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{margin:0;padding:20px;background:#f4f7fb;color:#222}
    .container{max-width:900px;margin:0 auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h1{margin-top:0;font-size:20px}
    form{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input,select,button{padding:8px 10px;border-radius:6px;border:1px solid #d6dde6}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:10px}
    .list{margin-top:18px}
    .card{padding:12px;border-radius:8px;border:1px solid #eef2f6;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    small{color:#666}
    .meta{font-size:12px;color:#666}
    .pill{background:#efefef;padding:6px 8px;border-radius:20px;font-size:12px}
    .muted{opacity:0.7}
    .debug{background:#0f172a;color:#fff;padding:8px;border-radius:6px;font-size:12px}
    .row{display:flex;gap:10px}
  </style>
</head>
<body>
  <!--
    healthcare_mvc.html

    Single-file front-end demo that implements MVC architecture (Model-View-Controller)

    HOW TO USE
    - Open this file in a browser. It uses localStorage to persist appointments (simulates the Data layer).
    - It separates concerns:
      * Model: data storage & retrieval (AppointmentModel)
      * View: rendering & DOM updates (AppointmentView)
      * Controller: business rules, validation, event wiring (AppointmentController)

    LOGGING / TESTING
    - Use browser console to inspect objects and call functions for unit-test style checks.

    GITHUB / UPLOAD
    - Create a repo, add this file and a README describing the MVC structure and testing steps.
    - Example README notes (add to repo): how MVC improves maintainability & testability (see comment block below)

    DESIGN JUSTIFICATION (short):
    - Maintainability: each component has a single responsibility — UI changes don't touch data logic.
    - Testability: Model and Controller methods are pure or return predictable results; they can be unit-tested in isolation.
    - Scalability: Replace the Model's storage (localStorage) with an API/backend without touching the View.
  -->

  <div class="container">
    <h1>Healthcare Appointment Booking — MVC Demo</h1>
    <p class="muted">This is a demonstration HTML file showing MVC separation in a small booking app. Data is stored in <code>localStorage</code> for demo purposes.</p>

    <section aria-labelledby="booking-form">
      <h2 id="booking-form" style="font-size:16px;margin-bottom:6px">Book an Appointment</h2>

      <form id="appointment-form" novalidate>
        <div>
          <label for="patientName">Patient Name</label>
          <input id="patientName" name="patientName" placeholder="e.g., Priya Sharma" required />
        </div>

        <div>
          <label for="doctor">Doctor</label>
          <select id="doctor" name="doctor">
            <option value="Dr. A">Dr. A — General Physician</option>
            <option value="Dr. B">Dr. B — Cardiologist</option>
            <option value="Dr. C">Dr. C — Dermatologist</option>
          </select>
        </div>

        <div>
          <label for="date">Date</label>
          <input id="date" name="date" type="date" required />
        </div>

        <div>
          <label for="time">Time</label>
          <input id="time" name="time" type="time" required />
        </div>

        <div class="full">
          <label for="notes">Notes (optional)</label>
          <input id="notes" name="notes" placeholder="e.g., follow-up for blood tests" />
        </div>

        <div class="full actions">
          <button id="create-btn" type="submit">Create Appointment</button>
          <button id="clear-btn" type="button">Clear All (local)</button>
          <button id="seed-btn" type="button">Seed Demo Data</button>
        </div>
      </form>

    </section>

    <section class="list">
      <h2 style="font-size:16px;margin-bottom:6px">Upcoming Appointments</h2>
      <div id="appointments"></div>
    </section>

    <section style="margin-top:16px">
      <h3 style="font-size:14px">Debug / Console</h3>
      <div class="debug" id="debug">Controller ready.</div>
    </section>
  </div>

  <script>
    /************************************************************************
     * MVC Implementation (client-side demo)
     * - Model: AppointmentModel -> handles data, persistence
     * - View: AppointmentView -> DOM rendering and UI helpers
     * - Controller: AppointmentController -> business logic, validation
     ************************************************************************/

    /* ---------------------- Model (Data layer) --------------------------- */
    class AppointmentModel {
      constructor(storageKey = 'appointments_v1'){
        this.storageKey = storageKey;
        this.appointments = this._load();
      }

      _load(){
        try{
          const raw = localStorage.getItem(this.storageKey);
          return raw ? JSON.parse(raw) : [];
        }catch(e){
          console.error('Failed to parse appointments from storage', e);
          return [];
        }
      }

      _save(){
        localStorage.setItem(this.storageKey, JSON.stringify(this.appointments));
      }

      getAll(){
        // return copy to prevent accidental modification
        return this.appointments.map(a => ({...a}));
      }

      add(appointment){
        // basic id generation
        const id = 'apt_' + Date.now() + '_' + Math.floor(Math.random()*9999);
        const record = Object.assign({id, createdAt: new Date().toISOString()}, appointment);
        this.appointments.push(record);
        this._save();
        return record;
      }

      remove(id){
        const before = this.appointments.length;
        this.appointments = this.appointments.filter(a => a.id !== id);
        if(this.appointments.length !== before) this._save();
      }

      clearAll(){
        this.appointments = [];
        this._save();
      }

      seed(sample){
        this.appointments = this.appointments.concat(sample.map(s => ({id:'apt_'+Math.random().toString(36).slice(2,9),...s}))); 
        this._save();
      }
    }

    /* ---------------------- View (UI layer) ----------------------------- */
    class AppointmentView{
      constructor(){
        this.appointmentsContainer = document.getElementById('appointments');
        this.form = document.getElementById('appointment-form');
        this.debugEl = document.getElementById('debug');
      }

      renderList(appointments){
        this.appointmentsContainer.innerHTML = '';
        if(!appointments.length){
          this.appointmentsContainer.innerHTML = '<p class="muted">No appointments. Create one using the form above.</p>';
          return;
        }

        appointments.sort((a,b)=> new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));

        appointments.forEach(apt => {
          const div = document.createElement('div');
          div.className = 'card';
          div.dataset.id = apt.id;

          const left = document.createElement('div');
          left.innerHTML = `<strong>${apt.patientName}</strong><br/><small class="meta">${apt.doctor} — ${apt.date} ${apt.time}</small>`;

          const right = document.createElement('div');
          const notes = document.createElement('div');
          notes.className = 'meta';
          notes.textContent = apt.notes || '';

          const btnRow = document.createElement('div');
          btnRow.className = 'row';

          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'Cancel';
          cancelBtn.dataset.action = 'cancel';

          const doneBtn = document.createElement('button');
          doneBtn.textContent = 'Mark Done';
          doneBtn.dataset.action = 'done';

          btnRow.appendChild(doneBtn);
          btnRow.appendChild(cancelBtn);

          right.appendChild(notes);
          right.appendChild(btnRow);

          div.appendChild(left);
          div.appendChild(right);

          this.appointmentsContainer.appendChild(div);
        });
      }

      setDebug(msg){
        this.debugEl.textContent = msg;
      }

      bindFormSubmit(handler){
        this.form.addEventListener('submit', (ev)=>{
          ev.preventDefault();
          const fd = new FormData(this.form);
          const payload = {
            patientName: fd.get('patientName').trim(),
            doctor: fd.get('doctor'),
            date: fd.get('date'),
            time: fd.get('time'),
            notes: fd.get('notes').trim()
          };
          handler(payload);
        });
      }

      bindCardActions(handler){
        this.appointmentsContainer.addEventListener('click', (ev)=>{
          const btn = ev.target.closest('button');
          if(!btn) return;
          const action = btn.dataset.action;
          const card = btn.closest('.card');
          if(!card) return;
          const id = card.dataset.id;
          handler(action, id);
        });
      }

      bindClear(handler){
        document.getElementById('clear-btn').addEventListener('click', ()=>handler());
        document.getElementById('seed-btn').addEventListener('click', ()=>handler(true));
      }
    }

    /* ------------------ Controller (Business logic) --------------------- */
    class AppointmentController{
      constructor(model, view){
        this.model = model;
        this.view = view;

        // wire view events
        this.view.bindFormSubmit(this.handleCreate.bind(this));
        this.view.bindCardActions(this.handleAction.bind(this));
        this.view.bindClear(this.handleClearOrSeed.bind(this));

        // initial render
        this.view.renderList(this.model.getAll());
        this.view.setDebug('Loaded ' + this.model.getAll().length + ' appointments.');
      }

      // Example business rule: no double-booking for same doctor/time
      async checkAvailability(doctor, date, time){
        // Simulate asynchronous check (e.g., RPC to server)
        await new Promise(res=>setTimeout(res,150));
        const existing = this.model.getAll().find(a=> a.doctor===doctor && a.date===date && a.time===time);
        return !existing; // true if available
      }

      async handleCreate(payload){
        // validation rules
        if(!payload.patientName) return this.view.setDebug('Patient name is required.');
        if(!payload.date || !payload.time) return this.view.setDebug('Date and time are required.');

        this.view.setDebug('Checking availability...');
        const ok = await this.checkAvailability(payload.doctor, payload.date, payload.time);
        if(!ok){
          this.view.setDebug('Selected slot is not available — choose another time.');
          return;
        }

        // Business logic could add reminders, notifications, or payment steps here.
        const created = this.model.add(payload);
        this.view.renderList(this.model.getAll());
        this.view.setDebug('Appointment created: ' + created.id);

        // reset form
        this.view.form.reset();
      }

      handleAction(action, id){
        if(action === 'cancel'){
          this.model.remove(id);
          this.view.renderList(this.model.getAll());
          this.view.setDebug('Appointment cancelled: ' + id);
          return;
        }

        if(action === 'done'){
          // For demo, marking done simply removes as well
          this.model.remove(id);
          this.view.renderList(this.model.getAll());
          this.view.setDebug('Appointment marked done: ' + id);
          return;
        }
      }

      handleClearOrSeed(seed=false){
        if(seed){
          const sample = [
            {patientName:'Amit Kumar', doctor:'Dr. A', date:this._futureDate(1), time:'10:30', notes:'Monthly check'},
            {patientName:'Rita Desai', doctor:'Dr. B', date:this._futureDate(2), time:'11:00', notes:'Chest pain consult'},
            {patientName:'Suresh Patel', doctor:'Dr. C', date:this._futureDate(3), time:'09:30', notes:''}
          ];
          this.model.seed(sample);
          this.view.renderList(this.model.getAll());
          this.view.setDebug('Seeded demo appointments.');
        }else{
          if(confirm('Clear all appointments from local storage?')){
            this.model.clearAll();
            this.view.renderList(this.model.getAll());
            this.view.setDebug('All appointments cleared.');
          }
        }
      }

      _futureDate(days){
        const d = new Date();
        d.setDate(d.getDate() + days);
        return d.toISOString().slice(0,10);
      }
    }

    /*********************** Boot the app *********************************/
    (function(){
      const model = new AppointmentModel();
      const view = new AppointmentView();
      const controller = new AppointmentController(model, view);

      // Expose objects for debugging/unit tests in console
      window.__MVC = {model, view, controller};
    })();
  </script>

  <!--
    NOTES: How MVC improves maintainability & testability (for README)

    1. Maintainability
       - Clear separation: UI (View) code only manipulates DOM; Data (Model) handles storage; Business rules (Controller) orchestrate interactions.
       - When adding new features (e.g., payment, notifications), add them to Controller or new services without changing View/Model heavily.

    2. Testability
       - Unit-test the Model methods (add/remove/getAll) without the DOM.
       - Test Controller's validation and availability logic by calling methods with mock Model instances.
       - Mock View in Controller tests to verify correct method calls (e.g., renderList, setDebug) without needing a browser.

    3. From demo to production
       - Replace AppointmentModel's localStorage persistence with API calls (fetch) to a real backend. Controller and View remain untouched.
       - On the backend use the same MVC pattern or a layered architecture (Controllers, Services, Repositories).

    GIT / GITHUB SUGGESTED STEPS
      1. Create repo, e.g., healthcare-appointment-mvc
      2. Add this file as `public/healthcare_mvc.html` and add README.md describing architecture and testing steps
      3. Commit and push: git add ., git commit -m "Add MVC demo frontend for appointment booking", git push origin main
      4. Optionally add a small Node/Express backend in `server/` and connect to this frontend via fetch API.
  -->
</body>
</html>
